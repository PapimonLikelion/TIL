### 2022-01-19

## 운영체제 - 프로세스 스케줄링
- 프로세스란 **실행 중인 프로그램** 이라고 정의했어요.
  컴퓨터에서 실행 중이란 것은 프로세스가 CPU 코어에서 명령어가 처리됨을 뜻하는데요.  
  여기서 하나 의문이 듭니다! 
  우리는 프로그램을 수십개씩 실행시킬 수 있지만, 컴퓨터엔 그만큼의 CPU 코어가 달려있진 않은데요!
  수십개의 프로세스들은 어떻게 컴퓨터에서 원활하게 실행될 수 있는걸까요? 

- 프로그램을 실행하면 프로세스가 되고, 프로세스는 컴퓨터 메모리에 존재해요. 
  그리고 현재 메모리에 있는 프로세스의 수를 다중 프로그래밍 정도라고 해요.
  요즘 컴퓨터는 다중 코어 시스템을 가지고 있는데요.
  한번에 여러 프로세스를 실행할 수 있어요.
  하지만 코어보다 많은 프로세스가 시스템에서 실행되는 경우 모든 프로세스가 동시에 실행될 수는 없어요. 
  프로세스들은 CPU 코어가 자신을 처리해 주도록 순서를 기다려야 해요.

- 스케줄링 큐를 소개할게요.
  앞선 뉴스레터에서 프로세스는 총 5가지 상태로 나뉜다고 했어요. 생성/실행/준비/대기/종료!
  생성된 프로세스는 **준비 큐** 에 들어가서 준비 상태가 되어요. CPU 코어에서 본인을 실행시켜주기를 기다리는 것이죠.
  이 준비 큐에는 PCB에 대한 포인터들이 저장되어 있어요. 준비 상태의 프로세스들이 순서대로 실행될 수 있도록 하는 거죠.

- 프로세스의 돌아가는 방식
  **대기 큐**에 들어가서 특정 I/O 이벤트가 발생하기를 기다린다.
  처음에 준비 큐에 놓임, 프로세스는 실행을 위해 선택되거나 디스패치 될 떄 까지 기다림
  프로세스에 CPU 코어 할당되고 실행 상태 되면 여러 이벤트가 발생 가능

  - 프로세스가 I/O 요청 받기로 하고 대기큐에...
  - 프로세스가 자식 프로세스 만들고 자식 종료될떄까지 대기큐에...
  - 인터럽트/타임슬라이스 만료되어 프로세스가 코어에서 강제로 제거되어 대기큐에...

- CPU 스케줄링
  프로세스는 수명주기 동안 준비큐와 대기큐를
  CPU 스케줄러가 준비 큐에 있는 프로세스 중에 선택된 하나의 프로세스에 CPU 코어를 할당하는 것
  실행될 다른 프로세스를 스케줄하도록 왔다갔다

- 엄청나게 많은 프로세스가 실행되면 메모리가 꽉차는 순간이 올거에요.
  그럴땐 스와핑을 통해 다중 프로그래밍 정도를 관리해요.
  메모리에서 프로세스 제거하여 다중 프로그래밍 정도 감소시키는 것
  메모리에서 디스크로 스왑아웃... 스와핑 => 메모리 꽉 차가지고 디스크로 내쫓기

- 문맥교환
  인터럽트를 통해 CPU 코어 뻇어서 커널 루틴 실행.
  인터럽트 발생하면 인터럽트 끝난 뒤에 다시 실행할 수 있도록 문맥을 저장해둬야겠지?
  이 문맥을 PCB로 표현해. CPU의 현재 상태를 저장하고, 나중에 복구할 수 있도록 하는거지.
  순수 오버헤드고 존나빨리 실행돼.

## Process vs Thread 테코톡
- *참고: https://www.youtube.com/watch?v=1grtWKqTn50&t=138s*
- **키워드**
  - 실행 단위 : CPU 코어에서 실행하는 하나의 단위로 프로세스/스레드를 포괄하는 개념
  - 프로세스 : 하나의 스레드만 가지는 단일 스레드 프로세스
  - 동시성 : 한 순간에 여러가지 일 X, 짧은 전환으로 여러 일을 동시에 처리하는 것 처럼 보이는 것

- **프로그램과 프로세스**
  - 프로그램 -> 프로세스 
    - 필요로 하는 재료들이 메모리에 올라감... code/data/heap/stack 영역으로 나뉘어서 메모리 공간을 확보
    - 해당 프로세스에 대한 정보 담은 PCB 블록이 생성... Pointer, State, PID, Program Counter

- **Process & Thread**
  - 다수 프로세스 동시에 실행하기 위해선 짧은 텀을 반복하면서 전환해서 실행
  - 쓰레드 == 경량화된 프로세스
    - 쓰레드에서는 프로세스의 공유 부분이 존재

- **멀티 프로세스 & 멀티 쓰레드 (처리 방식의 일종... SW에 가까움)**
  - ![](../images/2022-01-19-multiprocess&thread.PNG)
  - 멀티 쓰레드의 단점
    - 긴밀한 연결로 인해 하나의 쓰레드에서 문제가 생기면 전체 프로세스가 뇌절
  - 따라서 구글 크롬이 멀티 프로세스로 동작
    - 멀티탭들 간에 영향이 덜 가!

- **멀티 코어 (HW에 가까움)**
  - 동시성: 하나의 코어에서 빨리 여러 프로세스/쓰레드가 번갈아가며 실행
  - 병렬처리: 둘 이상의 코어에서 하나 이상의 프로세스가 한꺼번에 진행되는 것
