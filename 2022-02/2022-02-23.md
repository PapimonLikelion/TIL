### 2022-02-23

## 중개 테이블 활용한 JOIN 의문
- **문제**
  - 피드테크를 가장 많이 가진 피드의 id를 순서대로 10개 알려주세요 (동점일 시 feed_id 순서대로)

- **답변 1. 피드테크에서 테크 많이 쓴 feed_id를 추출하여 이를 피드와 JOIN**
    ```sql
    select feed.id
        from feed
        inner join 
            (select feed_id, count(*) as tech_used
                from feed_tech
                group by feed_id
                order by tech_used desc, feed_id asc 
                LIMIT 10) as feed_tech_info
            on feed.id = feed_tech_info.feed_id
        order by feed_tech_info.techused desc, feed_id asc;
    ```

- **답변 2. Order By 절에서 바로 feed_tech.feed_id 가 몇번 나왔는지 세서 구하기**
    ```sql
    select distinct feed.id 
        from feed 
        inner join feed_tech 
            on feed.id = feed_tech.feed_id 
        order by 
            (select count(feed_tech.feed_id) 
            from feed_tech 
            where feed.id = feed_tech.feed_id) desc, feed.id asc LIMIT 10;
    ```
    - 이미 feed와 feed_tech는 합쳐져 있음
    - 합쳐진 곳에서 order by 서브쿼리가 들어가기 때문에 가능한 것! <= Order by는 굉장히 나중에 실행된다는 것을 기억!
    - 쿼리 실행 순서를 기억해두자!

## SQL 쿼리 실행 순서
*참고: https://bicloud.tistory.com/20*
- **쿼리 실행 작동 순서**
  1. FROM
  2. ON
  3. JOIN
  4. WHERE
  5. GROUP BY
  6. HAVING (GROUP BY에서 where과 같은 조건을 담당)
  7. SELECT
  8. DISTINCT
  9. ORDER BY
  10. TOP
