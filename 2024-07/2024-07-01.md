### 2024-07-01

## Nginx geo 모듈
*참고: http://nginx.org/en/docs/http/ngx_http_geo_module.html*
- **개요**
  - `ngx_http_geo_module` 클라이언트 IP 주소에 따라 변수를 생성함

- **예시**
    ```
    geo $allowed_ip {
        default        0;
        127.0.0.1      1;
        192.168.1.0/24 1;
        10.1.0.0/16    1;
        2001:0db8::/32 1;
    }
    
    location = /test {
        if ($allowed_ip) {
          rewrite ^(.*)$ /index.html break;
        }
        return 404;
    }
    ```

- **설명**
  - 기본적으로 `$remote_addr`에서 IP 주소를 가져와서 비교
  - 만약 다른 변수에서 추출하고 싶다면 하기처럼도 가능
    ```
    geo $arg_remote_addr $geo {
        ...;
    }
    ```
  - 변수가 알맞은 ip가 아니라면, "255.255.255.255"로 간주됨
  - 변수로는 ip, CIDR, range가 사용 가능.
  - geo가 아마 지역기반으로 쓰라고 해서 이렇게 만들어진듯.
    ```
    geo $country {
        ranges;
        default                   ZZ;
        127.0.0.0-127.0.0.0       US;
        127.0.0.1-127.0.0.1       RU;
        127.0.0.1-127.0.0.255     US;
        10.1.0.0-10.1.255.255     RU;
        192.168.1.0-192.168.1.255 UK;
    }
    ```
